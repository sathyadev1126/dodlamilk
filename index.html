<!DOCTYPE html>
<html>
<head>
<title>Milk Khata Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}

body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#f5f7fa,#c3cfe2);
min-height:100vh;
}

/* HEADER */
.header{
background:#0b4fa2;
color:white;
padding:20px;
text-align:center;
font-size:22px;
font-weight:700;
}

/* SUMMARY */
.summary{
background:white;
margin:20px;
padding:20px;
border-radius:12px;
display:grid;
grid-template-columns:1fr 1fr;
gap:15px;
box-shadow:0 4px 10px #0002;
}

.summary div{text-align:center}

.green{color:#10b981;font-weight:700;font-size:22px}
.red{color:#ef4444;font-weight:700;font-size:22px}

/* SEARCH */
.search{margin:0 20px 20px}

.search input{
width:100%;
padding:14px;
border-radius:10px;
border:1px solid #ccc;
font-size:16px;
}

/* LIST */
.list{padding:0 20px 100px}

.card{
background:white;
padding:16px;
border-radius:12px;
margin-bottom:12px;
display:flex;
justify-content:space-between;
align-items:center;
cursor:pointer;
box-shadow:0 2px 8px #0002;
border-left:5px solid #0b4fa2;
position:relative;
}

.name{font-weight:700;font-size:18px}
.sub{font-size:13px;color:#666}

/* MENU */
.menu{
font-size:22px;
padding:5px 10px;
cursor:pointer;
}

.menu-box{
position:absolute;
right:10px;
top:40px;
background:white;
border-radius:8px;
box-shadow:0 4px 12px #0004;
display:none;
z-index:99;
}

.menu-box div{
padding:10px 16px;
cursor:pointer;
font-size:14px;
color:#dc2626;
}

.menu-box div:hover{
background:#f1f1f1;
}

/* ADD BTN */
.add-btn{
position:fixed;
bottom:25px;
right:25px;
background:#dc2626;
color:white;
border:none;
padding:16px 20px;
border-radius:50px;
font-weight:700;
cursor:pointer;
}

/* MODAL */
.modal{
display:none;
position:fixed;
top:0;left:0;right:0;bottom:0;
background:#0008;
z-index:1000;
}

.box{
background:white;
height:100%;
padding:20px;
overflow:auto;
}

/* DETAIL */
.d-header{
background:#0b4fa2;
color:white;
padding:15px;
display:flex;
align-items:center;
}

.back{cursor:pointer;font-size:22px}

.d-name{flex:1;text-align:center;font-weight:700}

.d-bal{
font-weight:600;
font-size:13px;
text-align:right;
}

/* ACTION */
.action{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
margin:15px 0;
}

.btn-bill,.btn-pay{
padding:14px;
border:none;
border-radius:10px;
color:white;
font-weight:600;
cursor:pointer;
}

.btn-bill{background:#2563eb}
.btn-pay{background:#16a34a}

/* INPUT */
.input{
background:white;
padding:15px;
border-radius:12px;
margin-bottom:15px;
box-shadow:0 2px 8px #0002;
}

.input input{
width:100%;
padding:12px;
margin:8px 0;
border-radius:8px;
border:1px solid #ccc;
}

.input button{
width:48%;
padding:12px;
border:none;
border-radius:8px;
margin:5px 1%;
cursor:pointer;
}

.btn-save{background:#0b4fa2;color:white}
.btn-cancel{background:#eee}

/* HISTORY */
.row{
background:white;
padding:12px;
border-radius:8px;
margin-bottom:8px;
font-size:14px;
border-left:4px solid #10b981;
}

.row.bill{border-color:#2563eb}
.row.pay{border-color:#16a34a}
</style>
</head>

<body>

<!-- HOME -->
<div id="home">

<div class="header">ü•õ Milk Khata Pro</div>

<div class="summary">
<div>Total Due<br><span id="totalDue" class="red">‚Çπ0</span></div>
<div>Customers<br><span id="totalCust">0</span></div>
</div>

<div class="search">
<input id="search" placeholder="Search..." oninput="renderList()">
</div>

<div id="list" class="list"></div>

<button class="add-btn" onclick="openAdd()">+ ADD</button>

</div>

<!-- ADD -->
<div id="addBox" class="modal">
<div class="box">

<h3>Add Customer</h3>

<div class="input">

<input id="cName" placeholder="Name">
<input id="cMob" placeholder="Mobile">

<button class="btn-save" onclick="addCustomer()" style="width:100%">Save</button>
<button class="btn-cancel" onclick="closeAdd()" style="width:100%">Cancel</button>

</div>

</div>
</div>

<!-- DETAIL -->
<div id="detail" class="modal">
<div class="box">

<div class="d-header">
<div class="back" onclick="closeDetail()">‚Üê</div>
<div id="dName" class="d-name"></div>
<div id="dBal" class="d-bal"></div>
</div>

<div class="action">
<button class="btn-bill" onclick="openInput('bill')">+ Bill</button>
<button class="btn-pay" onclick="openInput('pay')">+ Pay</button>
</div>

<div id="inputBox" class="input" style="display:none">

<h4 id="inputTitle"></h4>

<input id="entryDate" type="date">
<input id="amt" type="number" placeholder="Amount">

<button class="btn-save" onclick="saveEntry()">Save</button>
<button class="btn-cancel" onclick="closeInput()">Cancel</button>

</div>

<div id="hist"></div>

</div>
</div>

<script>

let customers=[];
let entries=[];
let currentCustomer=null;
let currentMode="";

/* STORAGE */
function saveData(){
localStorage.setItem("cust",JSON.stringify(customers));
localStorage.setItem("ent",JSON.stringify(entries));
}

/* MONEY */
function money(a){
return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(a);
}

/* LIST */
function renderList(){

let s=search.value.toLowerCase();
let list=document.getElementById("list");

list.innerHTML="";
let total=0;

customers
.filter(c=>c.name.toLowerCase().includes(s))
.forEach(c=>{

let e=entries.filter(x=>x.customerId===c.id);

let bill=e.reduce((a,b)=>a+b.bill,0);
let pay=e.reduce((a,b)=>a+b.paid,0);

let due=bill-pay;

total+=due;

list.innerHTML+=`

<div class="card" onclick="openDetail(${c.id})">

<div>
<div class="name">${c.name}</div>
<div class="sub">${c.phone||""}</div>
</div>

<div class="${due>0?'red':'green'}">${money(due)}</div>

<div class="menu" onclick="openMenu(event,${c.id})">‚ãÆ</div>

<div class="menu-box" id="menu-${c.id}">
  <div onclick="deleteCustomer(${c.id})">üóë Delete</div>
</div>

</div>

`;

});

totalDue.textContent=money(total);
totalCust.textContent=customers.length;
}

/* MENU */
function openMenu(e,id){
e.stopPropagation();

document.querySelectorAll(".menu-box")
.forEach(m=>m.style.display="none");

let box=document.getElementById("menu-"+id);

box.style.display=
box.style.display=="block"?"none":"block";
}

/* DELETE */
function deleteCustomer(id){

if(!confirm("Delete customer?")) return;

customers=customers.filter(c=>c.id!==id);
entries=entries.filter(e=>e.customerId!==id);

saveData();
renderList();
}

/* ADD */
function openAdd(){
addBox.style.display="block";
}

function closeAdd(){
addBox.style.display="none";
cName.value="";
cMob.value="";
}

function addCustomer(){

let name=cName.value.trim();

if(!name){
alert("Enter name");
return;
}

if(customers.some(c=>c.name.toLowerCase()==name.toLowerCase())){
alert("Already exists");
return;
}

customers.push({
id:Date.now(),
name,
phone:cMob.value
});

saveData();
closeAdd();
renderList();
}

/* DETAIL */
function openDetail(id){
currentCustomer=id;
home.style.display="none";
detail.style.display="block";
updateDetail();
}

function closeDetail(){
detail.style.display="none";
home.style.display="block";
inputBox.style.display="none";
renderList();
}

/* DAILY BREAKDOWN */
function updateDetail(){

let c = customers.find(x => x.id === currentCustomer);

dName.textContent = c.name;

let cust = entries.filter(e => e.customerId === currentCustomer);

let totalBill = 0;
let totalPaid = 0;

let today = new Date().toLocaleDateString("en-IN");

let todayBill = 0;
let todayPaid = 0;

cust.forEach(e => {

  totalBill += e.bill;
  totalPaid += e.paid;

  if(e.date.includes(today)){
    todayBill += e.bill;
    todayPaid += e.paid;
  }
});

let prevDue = (totalBill - totalPaid) - (todayBill - todayPaid);
let todayDue = todayBill - todayPaid;
let totalDue = totalBill - totalPaid;

dBal.innerHTML = `
  Prev: ‚Çπ${prevDue}<br>
  Today: ‚Çπ${todayDue}<br>
  Total: ‚Çπ${totalDue}
`;

/* HISTORY */
hist.innerHTML="";

cust.slice().reverse().forEach(e => {

  let cls = e.bill > 0 ? "row bill" : "row pay";

  hist.innerHTML += `
    <div class="${cls}">
      ${e.date}<br>
      ${e.bill ? "Bill: ‚Çπ"+e.bill : ""}
      ${e.paid ? "Paid: ‚Çπ"+e.paid : ""}
    </div>
  `;
});
}

/* INPUT */
function openInput(m){

currentMode=m;

inputBox.style.display="block";

inputTitle.textContent=
m=="bill"?"Add Bill":"Receive Payment";

entryDate.value=
new Date().toISOString().split("T")[0];

amt.value="";
amt.focus();
}

function closeInput(){
inputBox.style.display="none";
}

/* DATE */
function getDate(d){
let now=new Date();
if(d){
let p=d.split("-");
let x=new Date(p[0],p[1]-1,p[2],now.getHours());
return x.toLocaleString("en-IN");
}
return now.toLocaleString("en-IN");
}

/* SAVE */
function saveEntry(){

let v=amt.value;
let a=parseFloat(v);

if(!v||isNaN(a)||a<=0){
alert("Invalid amount");
return;
}

if(!entryDate.value){
alert("Select date");
return;
}

entries.push({

customerId:currentCustomer,

bill:currentMode=="bill"?a:0,
paid:currentMode=="pay"?a:0,

date:getDate(entryDate.value)

});

saveData();

closeInput();

updateDetail();
}

/* LOAD */
function loadData(){

let c=localStorage.getItem("cust");
let e=localStorage.getItem("ent");

if(c) customers=JSON.parse(c);
if(e) entries=JSON.parse(e);

renderList();
}

document.addEventListener("click",()=>{
document.querySelectorAll(".menu-box")
.forEach(m=>m.style.display="none");
});

loadData();

</script>

</body>
</html>
