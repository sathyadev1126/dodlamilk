<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Due Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f1f5f9;
  margin: 0;
  padding: 10px;
}

.container {
  background: white;
  padding: 15px;
  max-width: 100%;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h2, h3 {
  text-align: center;
}

.totalDue {
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  color: #dc2626;
  margin-bottom: 15px;
}

/* FORM */
.row {
  display: flex;
  flex-direction: column;
  margin-bottom: 10px;
}

.row span {
  margin-bottom: 4px;
  font-size: 14px;
}

input {
  width: 100%;
  padding: 10px;
  font-size: 16px;
}

button {
  padding: 10px;
  font-size: 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.add {
  width: 100%;
  background: #2563eb;
  color: white;
  margin-top: 10px;
}
.add:hover { background: #1e40af; }

.whatsapp {
  background: #22c55e;
  color: white;
}

.pay {
  background: #16a34a;
  color: white;
}

/* TABLE */
.table-wrapper {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-size: 14px;
  min-width: 600px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

.pending {
  color: red;
  font-weight: bold;
}

/* PAY INPUT */
.pay-input {
  width: 70px;
  padding: 6px;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="container">

<h2>ðŸ§¾ Due Management</h2>
<div class="totalDue" id="totalDue">Total Due: â‚¹0</div>

<!-- ADD DUE -->
<div class="row">
  <span>Name</span>
  <input id="name" placeholder="Customer name">
</div>

<div class="row">
  <span>Phone</span>
  <input id="phone" placeholder="10-digit number">
</div>

<div class="row">
  <span>Amount â‚¹</span>
  <input id="amount" type="number">
</div>

<button class="add" onclick="addDue()">âž• Add Due</button>

<hr>

<h3>ðŸ“‹ Due List</h3>

<div class="table-wrapper">
<table>
<thead>
<tr>
  <th>Name</th>
  <th>Due â‚¹</th>
  <th>Days</th>
  <th>WhatsApp</th>
  <th>Pay Now</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="dueList"></tbody>
</table>
</div>

</div>

<script>
/* ================= DATA ================= */
let dues = JSON.parse(localStorage.getItem("dues")) || [];
let totalDueAmount = Number(localStorage.getItem("totalDue")) || 0;

/* ================= CORE ================= */
function addDue() {
  let name = nameInput.value.trim();
  let phone = phoneInput.value.trim();
  let amount = Number(amountInput.value);

  if (!name || !phone || !amount) {
    alert("Fill all details");
    return;
  }

  dues.push({
    name,
    phone,
    amount,
    date: new Date(),
    status: "DUE"
  });

  totalDueAmount += amount;
  saveData();
  clearInputs();
  renderDues();
}

function renderDues() {
  let html = "";
  dues.forEach((d, i) => {
    if (d.status === "PAID") return;

    let days = Math.floor(
      (new Date() - new Date(d.date)) / (1000 * 60 * 60 * 24)
    );

    let message =
`Hello ${d.name},
Your milk due amount is â‚¹${d.amount}.
Pending from ${days} days.
Please clear it.
Thank you.`;

    let waLink =
`https://wa.me/91${d.phone}?text=${encodeURIComponent(message)}`;

    html += `
    <tr>
      <td>${d.name}</td>
      <td>â‚¹${d.amount}</td>
      <td class="pending">${days}</td>
      <td>
        <a href="${waLink}" target="_blank">
          <button class="whatsapp">Send</button>
        </a>
      </td>
      <td>
        <input type="number" class="pay-input" id="pay${i}">
        <button class="pay" onclick="payPartial(${i})">Pay</button>
      </td>
      <td>DUE</td>
    </tr>`;
  });

  dueList.innerHTML = html || "<tr><td colspan='6'>No dues</td></tr>";
  updateTotal();
}

/* ================= PAY ================= */
function payPartial(index) {
  let payAmt = Number(document.getElementById("pay" + index).value);

  if (!payAmt || payAmt <= 0) {
    alert("Enter valid amount");
    return;
  }

  if (payAmt > dues[index].amount) {
    alert("Amount greater than due");
    return;
  }

  dues[index].amount -= payAmt;
  totalDueAmount -= payAmt;

  if (dues[index].amount === 0) {
    dues[index].status = "PAID";
  }

  saveData();
  renderDues();
}

/* ================= STORAGE ================= */
function saveData() {
  localStorage.setItem("dues", JSON.stringify(dues));
  localStorage.setItem("totalDue", totalDueAmount);
}

function updateTotal() {
  totalDueElem.innerText = "Total Due: â‚¹" + totalDueAmount;
}

function clearInputs() {
  nameInput.value = phoneInput.value = amountInput.value = "";
}

/* ================= ELEMENTS ================= */
const nameInput = document.getElementById("name");
const phoneInput = document.getElementById("phone");
const amountInput = document.getElementById("amount");
const dueList = document.getElementById("dueList");
const totalDueElem = document.getElementById("totalDue");

/* ================= INIT ================= */
renderDues();
</script>

</body>
  </html>
